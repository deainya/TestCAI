# Запрос на обслуживание - Streamlit App

Приложение для создания запросов на обслуживание оборудования с чат-интерфейсом и интеграцией с n8n.

## Функциональность

- ✅ Валидация email пользователя
- ✅ Мобильный чат-интерфейс
- ✅ Интеграция с n8n через webhook
- ✅ Сбор данных о проблеме через диалог
- ✅ Итоговая форма с подтверждением
- ✅ Обработка ошибок

## Деплой на Streamlit Community Cloud

### 1. Подготовка репозитория

1. Загрузите файлы в GitHub репозиторий:
   - `app.py` - основное приложение
   - `requirements.txt` - зависимости

### 2. Настройка переменных окружения

В Streamlit Community Cloud добавьте переменную окружения:

```
N8N_WEBHOOK_URL = https://your-n8n-instance.com/webhook/your-webhook-id
```

### 3. Деплой

1. Перейдите на [share.streamlit.io](https://share.streamlit.io)
2. Подключите ваш GitHub репозиторий
3. Укажите путь к файлу: `app.py`
4. Добавьте переменную окружения `N8N_WEBHOOK_URL`
5. Нажмите "Deploy"

## Настройка n8n

### Структура входящих данных

Ваш n8n webhook должен принимать POST запросы с JSON payload:

```json
{
  "message": "Сообщение пользователя",
  "chat_history": [
    {
      "content": "Текст сообщения",
      "is_user": true/false
    }
  ],
  "problem_data": {
    "equipment_type": "Тип оборудования",
    "device_number": "Номер устройства", 
    "description": "Описание проблемы",
    "incident_date": "Дата инцидента",
    "photo_url": "URL фото"
  }
}
```

### Ожидаемый ответ от n8n

n8n должен возвращать JSON ответ:

```json
{
  "response": "Ответ ассистента пользователю",
  "problem_data": {
    "equipment_type": "Обновленные данные",
    "device_number": "Обновленные данные",
    "description": "Обновленные данные", 
    "incident_date": "Обновленные данные",
    "photo_url": "Обновленные данные"
  }
}
```

## Локальный запуск

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте файл `.streamlit/secrets.toml`:
```toml
N8N_WEBHOOK_URL = "https://your-n8n-instance.com/webhook/your-webhook-id"
```

3. Запустите приложение:
```bash
streamlit run app.py
```

## Структура приложения

- **Валидация email**: Пользователь должен ввести корректный email для доступа к чату
- **Чат-интерфейс**: Мобильно-оптимизированный интерфейс для диалога с ассистентом
- **Сбор данных**: Ассистент собирает информацию о проблеме через диалог
- **Итоговая форма**: Показ собранных данных с возможностью подтверждения
- **Обработка ошибок**: Корректная обработка ошибок подключения к n8n

## Обязательные поля для сбора

- Тип оборудования
- Номер устройства  
- Описание проблемы
- Дата инцидента
- Фото (опционально)

Ассистент будет задавать уточняющие вопросы, если какое-то из обязательных полей не заполнено.
