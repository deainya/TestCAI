# Запрос на обслуживание - Streamlit App

Простое приложение для создания заявок на обслуживание с чат-интерфейсом и интеграцией с n8n.

## Функциональность

- ✅ Валидация email пользователя
- ✅ Мобильный чат-интерфейс
- ✅ Интеграция с n8n через webhook
- ✅ Сбор данных заявки (тип оборудования, номер устройства, описание проблемы, дата, фото)
- ✅ Формирование итогового запроса с подтверждением
- ✅ Обработка ошибок и уведомления

## Деплой на Streamlit Community Cloud

### 1. Подготовка репозитория

1. Загрузите файлы в GitHub репозиторий:
   - `app.py` - основное приложение
   - `requirements.txt` - зависимости

### 2. Настройка Streamlit Community Cloud

1. Перейдите на [share.streamlit.io](https://share.streamlit.io)
2. Подключите ваш GitHub репозиторий
3. Укажите путь к файлу: `app.py`

### 3. Настройка переменных окружения

В настройках приложения добавьте секрет:

**Ключ:** `N8N_WEBHOOK_URL`  
**Значение:** URL вашего n8n webhook

### 4. Настройка n8n webhook

Ваш n8n webhook должен принимать JSON с следующей структурой:

```json
{
  "message": "сообщение пользователя",
  "chat_history": [
    {
      "content": "текст сообщения",
      "is_user": true/false,
      "timestamp": "2024-01-01T12:00:00"
    }
  ],
  "ticket_data": {
    "equipment_type": "тип оборудования",
    "device_number": "номер устройства", 
    "problem_description": "описание проблемы",
    "incident_date": "дата инцидента",
    "photo_url": "URL фото"
  },
  "user_email": "email@example.com"
}
```

И возвращать JSON с ответом:

```json
{
  "response": "ответ ассистента",
  "ticket_data": {
    "equipment_type": "обновленные данные",
    "device_number": "обновленные данные",
    "problem_description": "обновленные данные", 
    "incident_date": "обновленные данные",
    "photo_url": "обновленные данные"
  }
}
```

## Локальный запуск

```bash
pip install -r requirements.txt
streamlit run app.py
```

## Структура проекта

```
├── app.py              # Основное приложение
├── requirements.txt    # Зависимости Python
└── README.md          # Документация
```

## Особенности

- **Мобильная версия**: Адаптивный дизайн для мобильных устройств
- **Валидация email**: Проверка корректности email адреса
- **Обработка ошибок**: Таймауты, ошибки подключения, статус ответа
- **Session State**: Сохранение состояния между обновлениями страницы
- **Интеграция с n8n**: Асинхронная обработка через webhook
